{"version":3,"file":"jobpoller.min.js","sources":["../src/jobpoller.js"],"sourcesContent":["/**\n * Poll the background job until it is done/failed.\n *\n * @module     local_haccgen/jobpoller\n * @copyright  …\n * @license    …\n */\ndefine(['core/ajax', 'core/notification'], function(Ajax, Notification) {\n\n    /**\n     * Start polling a job id.\n     * @param {Number} jobid\n     */\n    const init = function(jobid) {\n\n        const spinner = document.getElementById('haccgen-spinner');\n        if (spinner) {\n            spinner.classList.remove('hidden');\n        }\n\n        const poll = function() {\n            Ajax.call([{\n                methodname : 'local_haccgen_check_job',\n                args       : { jobid: jobid }\n            }])[0].then(function(data) {\n\n                if (data.status === 'done') {\n                    // Give Moodle a moment to build session data then reload.\n                    window.setTimeout(function() { window.location.reload(); }, 1500);\n\n                } else if (data.status === 'failed') {\n                    Notification.alert(\n                        'Generation failed',\n                        data.errormsg || '',\n                        'Close'\n                    );\n                } else if (data.status === 'missing') {\n                    location.reload();\n                } else {\n                    setTimeout(poll, 5000);\n                }\n\n            }).catch(Notification.exception);\n        };\n\n        poll();\n    };\n\n    return /** @alias module:local_haccgen/jobpoller */ { init: init };\n});\n"],"names":["define","Ajax","Notification","init","jobid","spinner","document","getElementById","classList","remove","poll","call","methodname","args","then","data","status","window","setTimeout","location","reload","alert","errormsg","catch","exception"],"mappings":";;;;;;;AAOAA,kCAAO,CAAC,YAAa,sBAAsB,SAASC,KAAMC,oBAyCD,CAAEC,KAnC1C,SAASC,aAEZC,QAAUC,SAASC,eAAe,oBACpCF,SACAA,QAAQG,UAAUC,OAAO,gBAGvBC,KAAO,WACTT,KAAKU,KAAK,CAAC,CACPC,WAAa,2BACbC,KAAa,CAAET,MAAOA,UACtB,GAAGU,MAAK,SAASC,MAEG,SAAhBA,KAAKC,OAELC,OAAOC,YAAW,WAAaD,OAAOE,SAASC,WAAa,MAErC,WAAhBL,KAAKC,OACZd,aAAamB,MACT,oBACAN,KAAKO,UAAY,GACjB,SAEmB,YAAhBP,KAAKC,OACZG,SAASC,SAETF,WAAWR,KAAM,QAGtBa,MAAMrB,aAAasB,YAG1Bd"}