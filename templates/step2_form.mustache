{{! 
This file is part of Moodle

ISO Latin-1 encoding translations
Source: PostScript::ISOLatin1Encoding (Perl)

@package local_haccgen
@copyright 2026 Dynamicpixel Multimedia Solutions
@license GNU GPL v3 or later
}}

<div class="container-fluid haccgen-container">
    <div class="row">
        <!-- Left Side: Step 2 Form -->
        <div class="col-md-7">
            <div class="input-section">
                <form action="{{action}}" method="post" id="haccgen-form">
                    <input type="hidden" name="id" value="{{courseid}}">
                    <input type="hidden" name="step" value="{{currentstep}}">
                    <input type="hidden" name="generationtype" value="{{generationtype}}">

                    <!-- Level of Understanding -->
                    <div class="form-group">
                        <div class="d-flex align-items-center">
                            <label for="levelofunderstanding" class="mr-2">{{#str}}levelofunderstanding, local_haccgen{{/str}}</label>
                            {{#levelofunderstanding_helpicon}}{{> core/help_icon}}{{/levelofunderstanding_helpicon}}
                        </div>
                        <select name="levelofunderstanding" id="levelofunderstanding" class="form-control modern-input" required>
                            <option value="" disabled {{^has_levelofunderstanding}}selected{{/has_levelofunderstanding}}>{{#str}}select_level, local_haccgen{{/str}}</option>
                            <option value="Beginner" {{#is_level_beginner}}selected{{/is_level_beginner}}>{{#str}}beginner, local_haccgen{{/str}}</option>
                            <option value="Intermediate" {{#is_level_intermediate}}selected{{/is_level_intermediate}}>{{#str}}intermediate, local_haccgen{{/str}}</option>
                            <option value="Advanced" {{#is_level_advanced}}selected{{/is_level_advanced}}>{{#str}}advanced, local_haccgen{{/str}}</option>
                        </select>
                        {{#errors.levelofunderstanding}}<span class="error">{{errors.levelofunderstanding}}</span>{{/errors.levelofunderstanding}}
                    </div>

                    <!-- Tone of Narrative -->
                    <div class="form-group">
                        <div class="d-flex align-items-center">
                            <label for="toneofnarrative" class="mr-2">{{#str}}toneofnarrative, local_haccgen{{/str}}</label>
                         {{#toneofnarrative_helpicon}}{{> core/help_icon}}{{/toneofnarrative_helpicon}}
                        </div>
                        <select name="toneofnarrative" id="toneofnarrative" class="form-control modern-input" required>
                            <option value="" disabled {{^has_toneofnarrative}}selected{{/has_toneofnarrative}}>{{#str}}select_tone, local_haccgen{{/str}}</option>
                            <option value="Formal" {{#is_tone_formal}}selected{{/is_tone_formal}}>{{#str}}formal, local_haccgen{{/str}}</option>
                            <option value="Conversational" {{#is_tone_conversational}}selected{{/is_tone_conversational}}>{{#str}}conversational, local_haccgen{{/str}}</option>
                            <option value="Engaging" {{#is_tone_engaging}}selected{{/is_tone_engaging}}>{{#str}}engaging, local_haccgen{{/str}}</option>
                        </select>
                        {{#errors.toneofnarrative}}<span class="error">{{errors.toneofnarrative}}</span>{{/errors.toneofnarrative}}
                    </div>

                    <!-- Course Duration -->
                    <div class="form-group">
                        <div class="d-flex align-items-center">
                            <label for="courseduration" class="mr-2">{{#str}}courseduration, local_haccgen{{/str}}</label>
                             {{#courseduration_helpicon}}{{> core/help_icon}}{{/courseduration_helpicon}}
                        </div>
                        <select name="courseduration" id="courseduration" class="form-control modern-input" required>
                            <option value="" disabled {{^has_courseduration}}selected{{/has_courseduration}}>{{#str}}select_duration, local_haccgen{{/str}}</option>
                            <option value="Less than 15 minutes" {{#is_duration_15minutes}}selected{{/is_duration_15minutes}}>{{#str}}duration_15minutes, local_haccgen{{/str}}</option>
                            <option value="Less than 30 minutes" {{#is_duration_30minutes}}selected{{/is_duration_30minutes}}>{{#str}}duration_30minutes, local_haccgen{{/str}}</option>
                          <option value="Less than 60 minutes" {{#is_duration_60minutes}}selected{{/is_duration_60minutes}}>{{#str}}duration_60minutes, local_haccgen{{/str}}</option>
                        <option value="Less than 90 minutes" {{#is_duration_90minutes}}selected{{/is_duration_90minutes}}>{{#str}}duration_90minutes, local_haccgen{{/str}}</option>
                <option value="Less than 120 minutes" {{#is_duration_120minutes}}selected{{/is_duration_120minutes}}>{{#str}}duration_120minutes, local_haccgen{{/str}}</option>


                        </select>
                        {{#errors.courseduration}}<span class="error">{{errors.courseduration}}</span>{{/errors.courseduration}}
                    </div>

                     <!-- Course Language -->
<!-- Hidden Course Language -->
<input type="hidden" name="courselanguage" value="English">
    


<!-- Number of Topics -->
<!-- Hidden Number of Topics -->
<input type="hidden" name="numberoftopics" value="5">
 <input type="hidden" name="activelang" id="active-lang-step2" value="{{activelang}}">
   
 <div class="form-group d-flex justify-content-start gap-2">
                        <button type="submit" name="action" value="back" class="btn btn-secondary modern-btn modern-btn-secondary">{{#str}}back, local_haccgen{{/str}}</button>
                        <button type="submit" class="btn btn-primary modern-btn modern-btn-primary">{{#str}}proceed, local_haccgen{{/str}}</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Right Side: Preview -->
        <div class="col-md-5">
            <div class="step-progress-bar">
                <div class="step {{#stepstates.is_step1_active}}step-active{{/stepstates.is_step1_active}}" data-tooltip="Basics">
                    <span class="step-circle {{#stepstates.is_step1_active}}step-circle-active{{/stepstates.is_step1_active}}"></span>
                    <span class="step-label">{{#str}}basics, local_haccgen{{/str}}</span>
                </div>
                <div class="step-connector {{#stepstates.is_connector1_active}}connector-active{{/stepstates.is_connector1_active}}"></div>
                <div class="step {{#stepstates.is_step2_active}}step-active{{/stepstates.is_step2_active}}" data-tooltip="Details">
                    <span class="step-circle {{#stepstates.is_step2_active}}step-circle-active{{/stepstates.is_step2_active}}"></span>
                    <span class="step-label">{{#str}}details, local_haccgen{{/str}}</span>
                </div>
                <div class="step-connector {{#stepstates.is_connector2_active}}connector-active{{/stepstates.is_connector2_active}}"></div>
                <div class="step {{#stepstates.is_step3_active}}step-active{{/stepstates.is_step3_active}}" data-tooltip="Review">
                    <span class="step-circle {{#stepstates.is_step3_active}}step-circle-active{{/stepstates.is_step3_active}}"></span>
                    <span class="step-label">{{#str}}review, local_haccgen{{/str}}</span>
                </div>
                <div class="step-connector {{#stepstates.is_connector3_active}}connector-active{{/stepstates.is_connector3_active}}"></div>
                 <div class="step {{#stepstates.is_step4_active}}step-active{{/stepstates.is_step4_active}}" data-tooltip="Finalize">
                 <span class="step-circle {{#stepstates.is_step4_active}}step-circle-active{{/stepstates.is_step4_active}}"></span>
                 <span class="step-label">{{#str}}finalize, local_haccgen{{/str}}</span>
    </div>
            </div>
            <div class="card preview-card">
                <div class="card border-0 p-4" style="background-color: #fff; border-radius: 12px; width: 100%">
                    <div style="margin-bottom: 2rem;">
                        <div style="display: flex; align-items: center; gap: 6px; font-size: 0.9rem; color: #6c757d; border-bottom: 1px solid #ddd; padding-bottom: 4px; margin-bottom: 12px;">
                            <i class="fa fa-eye" aria-hidden="true"></i>
                            <span>{{#str}}previewtitle, local_haccgen{{/str}}</span>
                        </div>
                        <h4 style="margin: 0 0 1rem 0; font-weight: 600;" id="preview-title">{{TOPICTITLE}}</h4>
                        <div style="display: flex; flex-wrap: wrap; align-items: center; margin-bottom: 1rem;">
                            <span style="color: #6c757d; margin-right: 0.5rem;">{{#str}}audience, local_haccgen{{/str}}</span>
                            {{#audiencetags}}
                                <span style="background-color: #e0e0e0; border-radius: 20px; padding: 4px 12px; font-size: 0.85rem; margin-right: 8px; margin-bottom: 6px;">
                                    {{.}}
                                </span>
                            {{/audiencetags}}
                        </div>
                        <p style="color: #555; font-size: 0.95rem;" id="preview-audience">
                            {{#str}}courseisfor, local_haccgen, {"title": "{{TOPICTITLE}}", "audience": "{{targetaudience}}"}{{/str}}
                        </p>
                        <p style="color: #666; font-size: 0.9rem;" id="preview-level">
                            <strong>{{#str}}levelofunderstanding, local_haccgen{{/str}}:</strong> <span id="preview-level-value">{{levelofunderstanding}}</span>
                        </p>
                        <p style="color: #666; font-size: 0.9rem;" id="preview-tone">
                            <strong>{{#str}}toneofnarrative, local_haccgen{{/str}}:</strong> <span id="preview-tone-value">{{toneofnarrative}}</span>
                        </p>
                        <p style="color: #666; font-size: 0.9rem;" id="preview-duration">
                            <strong>{{#str}}courseduration, local_haccgen{{/str}}:</strong> <span id="preview-duration-value">{{courseduration}}</span>
                        </p>
                        {{#pdfuploaded}}
                        <p id="preview-file" style="color: #666; font-size: 0.9rem;">
                            <strong>{{#str}}pdfuploaded, local_haccgen{{/str}}</strong> <span id="preview-file-value">{{pdfuploaded}}</span>
                        </p>
                        {{/pdfuploaded}}
     
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* General Layout */
.haccgen-container {
    padding: 20px;
    background: #ffffff;
    min-height: 100vh;
    position: relative;
    z-index: 1;
}

body {
    position: relative;
    z-index: 0;
    background: #ffffff;
}

/* Enhanced Step Progress Bar */
.step-progress-bar {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 25px;
    position: relative;
    margin-top: 25px;
}

.step {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
}

.step-circle {
    width: 25px;
    height: 25px;
    border-radius: 50%;
    background: #0069cc;
    color: #666;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 1.2rem;
    border: 2px solid #bbb;
}

.step-circle-active {
    background: #0069cc;
    color: #ffffff;
    border: 2px solid #0056b3;
}

.step-label {
    margin-top: 8px;
    font-size: 1rem;
    color: #666;
    font-family: 'Roboto', sans-serif;
}

.step-active .step-label {
    color: #0069cc;
}

.step-connector {
    width: 60px;
    height: 2.5px;
    background: #e0e0e0;
    margin: 0 0px;
    border-radius: 2px;
    margin-bottom: 25px;
}

.connector-active {
    background: #0069cc;
}

/* Tooltip Styling */
.step::after {
    content: attr(data-tooltip);
    position: absolute;
    top: -40px;
    background: #333;
    color: #fff;
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 0.9rem;
    font-family: 'Roboto', sans-serif;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease, transform 0.3s ease;
    transform: translateY(10px);
}

.step:hover::after {
    opacity: 1;
    transform: translateY(0);
}

/* Pulse Animation */
@keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(0, 123, 255, 0.4); }
    70% { box-shadow: 0 0 0 10px rgba(0, 123, 255, 0); }
    100% { box-shadow: 0 0 0 0 rgba(0, 123, 255, 0); }
}

/* Input Section */
.input-section {
    padding: 20px;
    background: #ffffff;
    border-radius: 10px;
}

/* Card Styling (Preview) */
.preview-card {
    border: 1px solid #ddd;
    border-radius: 10px;
    background: #ffffff;
    margin-top: 40px;
}

#preview-title {
    color: #333;
    font-size: 1.6rem;
    margin-bottom: 15px;
    font-weight: 500;
    font-family: 'Roboto', sans-serif;
    animation: slideIn 0.5s ease;
}

#preview-audience, #preview-level, #preview-tone, #preview-duration, #preview-file {
    font-style: italic;
    color: #666;
    font-size: 1.1rem;
    font-family: 'Roboto', sans-serif;
    animation: slideIn 0.5s ease 0.2s;
}

/* Input Styling */
.form-group {
    margin-bottom: 1.5rem;
}

.modern-input {
    border: 1px solid #ddd;
    border-radius: 8px;
   
    background: lightgrey;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
    font-family: 'Roboto', sans-serif;
    font-size: 1rem;
    color: #333;
}

.modern-input:focus {
    border-color: #0069cc;
    box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.2);
    outline: none;
}

label {
    font-weight: 500;
    color: #333;
    margin-bottom: 5px;
    font-family: 'Roboto', sans-serif;
    font-size: 1rem;
}

/* Button Styling */
.modern-btn {
    padding: 10px 20px;
    border-radius: 8px;
    font-weight: 500;
    font-family: 'Roboto', sans-serif;
    transition: background 0.3s ease, transform 0.3s ease;
    color: #fff;
    margin-left:8px;
}

.modern-btn-secondary {
    background: #6c757d;
    border: none;
}

.modern-btn-secondary:hover {
    background: #5a6268;
    transform: translateY(-2px);
}

.modern-btn-primary {
    background: #0069cc;
    border: none;
}

.modern-btn-primary:hover {
    background: #0056b3;
    transform: translateY(-2px);
}

/* Error Styling */
.error {
    color: #ff4d4d;
    font-size: 0.9em;
    margin-top: 5px;
    display: block;
    font-family: 'Roboto', sans-serif;
}

/* Animations */
@keyframes slideIn {
    from { opacity: 0; transform: translateX(20px); }
    to { opacity: 1; transform: translateX(0); }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Only run for step 2
    const stepInput = document.querySelector('input[name="step"]');
    if (!stepInput || stepInput.value !== '2') {
        console.log('Skipping step2_form JavaScript for step != 2');
        return;
    }

    // Form elements
    const levelSelect = document.getElementById('levelofunderstanding');
    const toneSelect = document.getElementById('toneofnarrative');
    const durationSelect = document.getElementById('courseduration');


    const previewLevel = document.getElementById('preview-level-value');
    const previewTone = document.getElementById('preview-tone-value');
    const previewDuration = document.getElementById('preview-duration-value');

    function animateUpdate(previewElement, value, delay = 0) {
        if (previewElement) {
            previewElement.textContent = value || 'Not selected';
            previewElement.style.animation = 'none';
            setTimeout(() => {
                previewElement.style.animation = `slideIn 0.5s ease ${delay}s`;
            }, 10);
        }
    }

    function updatePreview() {
        animateUpdate(previewLevel, levelSelect?.value, 0);
        animateUpdate(previewTone, toneSelect?.value, 0.2);
        animateUpdate(previewDuration, durationSelect?.value, 0.4);
        
    }

    // Initial preview update
    updatePreview();

    // Event listeners
    if (levelSelect) levelSelect.addEventListener('change', updatePreview);
    if (toneSelect) toneSelect.addEventListener('change', updatePreview);
    if (durationSelect) durationSelect.addEventListener('change', updatePreview);
;

    // âœ… Spinner logic on form submission
    const form = document.getElementById('haccgen-form');
    const continueButton = form.querySelector('button[type="submit"]:not([name="action"])');
    const backButton = form.querySelector('button[name="action"][value="back"]');

    form.addEventListener('submit', function(event) {
        // Skip spinner if 'Back' is clicked
        if (event.submitter === backButton) return;

        // Disable Continue button and show spinner
        if (continueButton) {
            continueButton.disabled = true;
            continueButton.innerHTML = `
                <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                Just a Sec..
            `;
        }

        if (backButton) backButton.disabled = true;
    });
});
</script>
